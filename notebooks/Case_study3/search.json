[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Case_study3: mouse skin lipids dataset",
    "section": "",
    "text": "In this case study, we performed processing and annotation on a mouse skin lipid dataset. Annotation is based on m/z and CCS matching against CCS Compendium.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Overview</span>"
    ]
  },
  {
    "objectID": "7-lipids_annotation.html",
    "href": "7-lipids_annotation.html",
    "title": "2  Downstream Analysis – feature annotation",
    "section": "",
    "text": "2.0.1 Introduction\nIn this case study, we process a MALDI-TIMS-MS1 lipids dataset of mouse skin tissue, extract features with m/z and ion mobility, then convert ion mobility into collision cross section(CCS), and annotate features by looking up m/z and CCS in CCS compendium.\n\nimport timsimaging\n\n# enable visualization in the Jupyter notebook\nfrom bokeh.io import show, output_notebook\noutput_notebook()\n# disable FutureWarning\nimport warnings\nwarnings.filterwarnings('ignore', category=FutureWarning)\n\n    \n    \n        \n        Loading BokehJS ...\n    \n\n\n\n\n\n\nbruker_d_folder_name = r\"D:\\dataset\\Melanie\\MF402upper.d\"\ndataset = timsimaging.spectrum.MSIDataset(bruker_d_folder_name)\ndataset\n\n100%|██████████████████████████████████████████████████████████████████████████| 65052/65052 [00:13&lt;00:00, 4783.46it/s]\n\n\nMSIDataset with 65052 pixels\n        mz range: 299.999-1350.004\n        mobility range: 0.700-1.960\n        \n\n\n\ndataset.image()\n\n\n  \n\n\n\n\n\n\n\n2.0.2 Peak processing\nFirst we run the processing workflow to get the feature list. There are 3 columns in the result: m/z, ion mobility and intensity. The ion mobility is in \\(1/K_0\\) (inverse reduced mobility), of which the unit is \\(V\\cdotp s\\cdotp cm^{-2}\\)\n\nresults = dataset.process(sampling_ratio=0.1, frequency_threshold=0.02, tolerance=3, adaptive_window=True, visualize=False)\npeak_list = results[\"peak_list\"]\npeak_list\n\nComputing mean spectrum...\nTraversing graph...\nFinding local maxima...\nSummarizing...\n\n\n100%|████████████████████████████████████████████████████████████████████████████████| 930/930 [02:41&lt;00:00,  5.77it/s]\n\n\n\n\n\n\n\n\n\nmz_values\nmobility_values\ntotal_intensity\n\n\n\n\n1\n302.058416\n0.906070\n28.807071\n\n\n2\n303.065771\n0.907390\n273.366334\n\n\n3\n303.065934\n1.076893\n73.819985\n\n\n4\n303.065516\n0.948773\n8.603689\n\n\n5\n304.069069\n0.906924\n3.887010\n\n\n...\n...\n...\n...\n\n\n926\n1253.899905\n1.844601\n14.027978\n\n\n927\n1255.913279\n1.853024\n26.725288\n\n\n928\n1281.929607\n1.870141\n25.601230\n\n\n929\n1283.943538\n1.877011\n2.597694\n\n\n930\n1298.554342\n1.759565\n7.082859\n\n\n\n\n930 rows × 3 columns\n\n\n\n\n\n2.0.3 Converting ion mobility into CCS\nHowever, \\(1/K_0\\) depends on the ion mobility technique and instrument. The data was collected by trapped ion mobility spectrometry(TIMS) while most ion mobility databases are from drift tube(DTIMS), to allow cross-platform comparison, we need to convert ion mobility into CCS, a property only depends on the ion itself.\nTIMSImaging converts \\(1/K_0\\) into CCS by a linear model fitted with reference ion mobilities of calibrants. The metadata of calibration is stored in the raw data:\n\ndataset.cali_info\n\n\n\n\n\n\n\n\nKeyPolarity\nValue\n\n\nKeyName\n\n\n\n\n\n\nCalibrationDateTime\n+\n2024-07-28T12:37:35+02:00\n\n\nCalibrationUser\n+\nunknown\n\n\nCalibrationSoftware\n+\ntimsTOF\n\n\nCalibrationSoftwareVersion\n+\n5.1.8\n\n\nMzCalibrationMode\n+\n4\n\n\nMzStandardDeviationPPM\n+\n0.209581\n\n\nReferenceMassList\n+\nRedP_0_to_2000 07-03-2024 New List\n\n\nMzCalibrationSpectrumDescription\n+\n&lt;unknown&gt;\n\n\nReferenceMassPeakNames\n+\nb'p3\\x00p5\\x00p9\\x00p17\\x00p21\\x00p25\\x00p29\\x...\n\n\nReferencePeakMasses\n+\nb'\\x17\\xd9\\xce\\xf7S\"\\x8a@\\xc5 \\xb0r\\xe8\\x11\\x8...\n\n\nMeasuredTimesOfFlight\n+\nb'!\\xe8\\xa9\\xb9\\x14\\x0c\\xf2@e\\xaeo\\xd5\\x7f\\xb3...\n\n\nMeasuredMassPeakIntensities\n+\nb'\\x00\\x00\\x00\\x00\\x80&lt;\\xc6@\\x00\\x00\\x00\\x00\\x...\n\n\nMassesPreviousCalibration\n+\nb'\\xe0\\xf4\\xb4cY\"\\x8a@\\xd79uE\\xec\\x11\\x8c@\\x7f...\n\n\nMassesCorrectedCalibration\n+\nb'\\x962\\xe9BT\"\\x8a@B\\x8e\\xd8\\xe1\\xe7\\x11\\x8c@\\...\n\n\nMobilityCalibrationDateTime\n+\n2024-07-27T13:42:36+02:00\n\n\nMobilityCalibrationUser\n+\nunknown\n\n\nMobilityStandardDeviationPercent\n+\n0.175188\n\n\nReferenceMobilityList\n+\nTuning Mix ES-TOF CCS compendium (ESI)\n\n\nCalibrationMobilogramDescription\n+\n&lt;unknown&gt;\n\n\nReferenceMobilityPeakNames\n+\nb'C6H19N3O6P3\\x00C12H19F12N3O6P3\\x00C18H19F24N...\n\n\nReferencePeakMobilities\n+\nb'\\xbe\\xa3\\x80$\\x12\\x90\\xe7?\\x00\\xa0\\xefq\\x07\\...\n\n\nMeasuredTimsVoltages\n+\nb':\\xe9\\xb9o{uY@\\x9d\\xa9\\x10\\x8a\\x9ada@\\x8a:0,...\n\n\nMeasuredMobilityPeakIntensities\n+\nb'\\x0eJ\\x96\\x80\\x13\\xe1CA\\xdce\\xc5&\\xb0\\x9feA\\...\n\n\nMobilitiesPreviousCalibration\n+\nb'\\x8a^\\x97]\\xd1\\x9e\\xe7?\\xfd\\xdap2s\\xd5\\xef?\\...\n\n\nMobilitiesCorrectedCalibration\n+\nb'\\xb5\\x1aw\\xe9\\xb5\\x8c\\xe7?\"d\\xaaG\\x9a\\xc6\\xe...\n\n\nMobilitiyReferencePressure\n+\n2.195872\n\n\nMobilitiyPressureCompensationFactor\n+\n50.000000\n\n\n\n\n\n\n\nCompute CCS. We also have an option to call interal CCS conversion function from Bruker’s TDFSDK API. Here we compute CCS in both methods.\n\nccs_linear_model = dataset.ccs_calibrator(method=\"linear\")\npeak_list[\"CCS_linear\"] = ccs_linear_model.transform(peak_list[\"mz_values\"], peak_list[\"mobility_values\"], charge=1)\nccs_bruker_model = dataset.ccs_calibrator(method=\"internal\")\npeak_list[\"CCS_bruker\"] = ccs_bruker_model.transform(peak_list[\"mz_values\"], peak_list[\"mobility_values\"], charge=1)\npeak_list[\"Delta\"] = (peak_list[\"CCS_bruker\"]-peak_list[\"CCS_linear\"])/peak_list[\"CCS_bruker\"]\n\n\npeak_list\n\n\n\n\n\n\n\n\nmz_values\nmobility_values\ntotal_intensity\nCCS_linear\nCCS_bruker\nDelta\n\n\n\n\n1\n302.058416\n0.906070\n28.807071\n189.238376\n189.666498\n0.002257\n\n\n2\n303.065771\n0.907390\n273.366334\n189.489590\n189.916152\n0.002246\n\n\n3\n303.065934\n1.076893\n73.819985\n225.188273\n225.393028\n0.000908\n\n\n4\n303.065516\n0.948773\n8.603689\n198.205047\n198.577456\n0.001875\n\n\n5\n304.069069\n0.906924\n3.887010\n189.364654\n189.791992\n0.002252\n\n\n...\n...\n...\n...\n...\n...\n...\n\n\n926\n1253.899905\n1.844601\n14.027978\n374.204010\n373.482918\n-0.001931\n\n\n927\n1255.913279\n1.853024\n26.725288\n375.913545\n375.181832\n-0.001950\n\n\n928\n1281.929607\n1.870141\n25.601230\n379.316539\n378.563683\n-0.001989\n\n\n929\n1283.943538\n1.877011\n2.597694\n380.709363\n379.947853\n-0.002004\n\n\n930\n1298.554342\n1.759565\n7.082859\n356.744077\n356.131468\n-0.001720\n\n\n\n\n930 rows × 6 columns\n\n\n\nThe results from TIMSImaging are almost the same with those from Bruker’s method.\n\n\n2.0.4 Query features against CCS database\nNow we can search m/z and CCS in a database to obtain putative feature annotation. Here we use CCS compendium, which could be downloaded from https://mcleanresearchgroup.shinyapps.io/CCS-Compendium\n\nimport pandas as pd\ndef query_feature(mz, ccs, i, library, ppm_tol=20, ccs_tol=5):\n\n    columns = ['Compound', 'Neutral.Formula', 'CAS',\n        'Theoretical.mz', 'Ion.Species', 'Charge',\n        'CCS', 'Super.Class',\n        'Class', 'Subclass']\n    # ppm window\n    mz_tol = mz * ppm_tol * 1e-6\n    mz_min, mz_max = mz - mz_tol, mz + mz_tol\n    \n    ccs_min, ccs_max = ccs - ccs_tol, ccs + ccs_tol\n    hit_index =  (library['mz'].between(mz_min, mz_max)) & (library['CCS'].between(ccs_min, ccs_max))\n    # candidate subset by adduct and mz\n    hits = library.loc[hit_index, columns].copy()\n    hits[\"feature_id\"] = i\n    hits[\"measured_mz\"] = mz\n    hits[\"measured_CCS\"] = ccs\n    hits[\"ppm_error\"] = (hits[\"Theoretical.mz\"] - mz) / mz * 1e6\n    hits[\"ccs_dev_%\"] = ((hits[\"CCS\"] - ccs) / ccs).abs() * 100\n\n    if hits.empty:\n        return pd.DataFrame()\n    return hits\n\nTo save time, we search against a subset of the database: lipids with +1 charge state:\n\nlibrary = pd.read_csv(r\"D:\\dataset\\UnifiedCCSCompendium_FullDataSet_2025-07-28.csv\")\nlipids_lib = library.loc[\n    (library[\"Super.Class\"]==\"Lipids and lipid-like molecules\")&\n    (library[\"Charge\"]==1)\n    ]\nlipids_lib\n\n\n\n\n\n\n\n\nCompound\nNeutral.Formula\nCAS\nInChi\nInChiKey\nTheoretical.mz\nmz\nIon.Species\nIon.Species.Agilent\nCharge\n...\nRep5\nRep6\nRep7\nRep8\nRep9\nRep10\nRep11\nRep12\nRep13\nRep14\n\n\n\n\n1045\n5-iPF2alpha-VI\nC20H34O5\n180469-63-0\nInChI=1S/C20H34O5/c1-2-3-4-5-6-7-10-16-17(19(2...\nRZCPXIZGLPAGEV-UHFFFAOYSA-N\n377.2304\n377.2304\n[M+Na]\n(M+Na)+\n1\n...\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n1047\n8-iso-15(R)-Prostaglandin F2alpha\nC20H34O5\n214748-65-9\nInChI=1S/C20H34O5/c1-2-3-6-9-15(21)12-13-17-16...\nPXGPLTODNUVGFL-PGWUFSIFSA-N\n377.2304\n377.2304\n[M+Na]\n(M+Na)+\n1\n...\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n1049\n8-iso-Prostaglandin F2alpha\nC20H34O5\n27415-26-5\nInChI=1S/C20H34O5/c1-2-3-6-9-15(21)12-13-17-16...\nPXGPLTODNUVGFL-NAPLMKITSA-N\n377.2304\n377.2304\n[M+Na]\n(M+Na)+\n1\n...\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n1051\n15(R)-Prostaglandin F2alpha\nC20H34O5\n37658-84-7\nInChI=1S/C20H34O5/c1-2-3-6-9-15(21)12-13-17-16...\nPXGPLTODNUVGFL-CKXCCYAOSA-N\n377.2304\n377.2304\n[M+Na]\n(M+Na)+\n1\n...\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n1053\n11-beta-Prostaglandin F2alpha\nC20H34O5\n38432-87-0\nInChI=1S/C20H34O5/c1-2-3-6-9-15(21)12-13-17-16...\nPXGPLTODNUVGFL-ZWAKLXPCSA-N\n377.2304\n377.2304\n[M+Na]\n(M+Na)+\n1\n...\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n3666\nProgesterone\nC21H30O2\n57-83-0\nInChI=1S/C21H30O2/c1-13(22)17-6-7-18-16-5-4-14...\nRJKFOVLPORLFTN-LEKSSAKUSA-N\n337.2144\n337.2143\n[M+Na]\n(M+Na)+\n1\n...\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n3668\n17-alpha-Hydroxyprogesterone\nC21H30O3\n68-96-2\nInChI=1S/C21H30O3/c1-13(22)21(24)11-8-18-16-5-...\nDBPWSSGDRRHUNT-CEGNMAFCSA-N\n331.2273\n331.2273\n[M+H]\n(M+H)+\n1\n...\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n3669\n17-alpha-Hydroxyprogesterone\nC21H30O3\n68-96-2\nInChI=1S/C21H30O3/c1-13(22)21(24)11-8-18-16-5-...\nDBPWSSGDRRHUNT-CEGNMAFCSA-N\n353.2093\n353.2093\n[M+Na]\n(M+Na)+\n1\n...\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n3670\nd7-Cholesterol Ester (18:1)\nC45H71D7O2\n1416275-35-8\nInChI=1S/C45H78O2/c1-7-8-9-10-11-12-13-14-15-1...\nRJECHNNFRHZQKU-IHPCOYDHSA-N\n680.6339\n680.6305\n[M+Na]\n(M+Na)+\n1\n...\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n3671\nCholesteryl Palmitate\nC43H76O2\n601-34-3\nInChI=1S/C43H76O2/c1-7-8-9-10-11-12-13-14-15-1...\nBBJQPKLGPMQWBU-JADYGXMDSA-N\n647.5743\n647.5704\n[M+Na]\n(M+Na)+\n1\n...\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n\n\n664 rows × 37 columns\n\n\n\nQuery features with m/z tolerance=20 ppm and CCS tolerance=5 \\(\\mathring{A}^2\\):\n\nall_results = []\nfor i, feat in peak_list.iterrows():\n    all_results.append(query_feature(feat['mz_values'], feat['CCS_linear'], i, lipids_lib, ppm_tol=20, ccs_tol=5))\n\n\nfinal_results = pd.concat([r for r in all_results if not r.empty],\n                              ignore_index=True) if any(not r.empty for r in all_results) else pd.DataFrame()\nfinal_results\n\n\n\n\n\n\n\n\nCompound\nNeutral.Formula\nCAS\nTheoretical.mz\nIon.Species\nCharge\nCCS\nSuper.Class\nClass\nSubclass\nfeature_id\nmeasured_mz\nmeasured_CCS\nppm_error\nccs_dev_%\n\n\n\n\n0\nLysoPC (13:0)\nC21H44NO7P\n20559-17-5\n454.2933\n[M+H]\n1\n217.70\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n179\n454.302122\n212.734417\n-19.418093\n2.334170\n\n\n1\nLithocholyltaurine\nC26H45NO5S\n6042-32-6\n506.2916\n[M+Na]\n1\n213.30\nLipids and lipid-like molecules\nSteroids and steroid derivatives\nBile acids, alcohols and derivatives\n232\n506.299203\n217.302892\n-15.017336\n1.842080\n\n\n2\nLysoPC (16:0)\nC24H50NO7P\n17364-16-8\n518.3223\n[M+Na]\n1\n234.30\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n239\n518.332071\n235.840590\n-18.850706\n0.653234\n\n\n3\nLysoPC (18:1)\nC26H52NO7P\n19420-56-5\n522.3559\n[M+H]\n1\n233.20\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n245\n522.365273\n235.736654\n-17.942795\n1.076054\n\n\n4\n1,2-Didecanoyl-sn-glycero-3-phosphoethanolamine\nC25H50NO8P\n253685-27-7\n524.3352\n[M+H]\n1\n235.40\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoethanolamines\n250\n524.344495\n236.731846\n-17.727345\n0.562597\n\n\n5\nLysoPC (18:0)\nC26H54NO7P\n19420-57-6\n524.3716\n[M+H]\n1\n238.80\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n251\n524.380728\n240.115902\n-17.406327\n0.548028\n\n\n6\nLysoPC (2-18:0)\nC26H54NO7P\n27098-24-4\n524.3716\n[M+H]\n1\n240.70\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n251\n524.380728\n240.115902\n-17.406327\n0.243257\n\n\n7\nPlatelet-activating Factor\nC26H54NO7P\n74389-68-7\n524.3716\n[M+H]\n1\n239.30\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n251\n524.380728\n240.115902\n-17.406327\n0.339795\n\n\n8\nLysoPC (19:0)\nC27H56NO7P\n108273-88-7\n538.3872\n[M+H]\n1\n240.50\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n262\n538.395407\n243.788239\n-15.242698\n1.348810\n\n\n9\nPC (17:0/02:0)\nC27H56NO7P\n93037-84-4\n538.3872\n[M+H]\n1\n244.20\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n262\n538.395407\n243.788239\n-15.242698\n0.168901\n\n\n10\nLysoPC (18:1)\nC26H52NO7P\n19420-56-5\n544.3379\n[M+Na]\n1\n236.70\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n268\n544.347728\n233.680295\n-18.055166\n1.292238\n\n\n11\nLysoPC (18:0)\nC26H54NO7P\n19420-57-6\n546.3536\n[M+Na]\n1\n241.50\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n272\n546.361114\n242.741801\n-13.753318\n0.511573\n\n\n12\nLysoPC (2-18:0)\nC26H54NO7P\n27098-24-4\n546.3536\n[M+Na]\n1\n242.20\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n272\n546.361114\n242.741801\n-13.753318\n0.223201\n\n\n13\nPlatelet-activating Factor\nC26H54NO7P\n74389-68-7\n546.3536\n[M+Na]\n1\n240.80\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n272\n546.361114\n242.741801\n-13.753318\n0.799945\n\n\n14\nPC (16:0E/2:0)\nC26H54NO7P\n74389-68-8\n546.3536\n[M+Na]\n1\n240.60\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n272\n546.361114\n242.741801\n-13.753318\n0.882337\n\n\n15\nLysoPC (20:0)\nC28H58NO7P\n108341-80-6\n552.4029\n[M+H]\n1\n247.00\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n281\n552.409856\n247.601055\n-12.591734\n0.242752\n\n\n16\nPC (O-18:0/2:0)\nC28H58NO7P\n74389-69-8\n552.4029\n[M+H]\n1\n247.50\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n281\n552.409856\n247.601055\n-12.591734\n0.040814\n\n\n17\n1,2-Dilauroyl-sn-glycero-3-phosphocholine\nC32H64NO8P\n18194-25-7\n622.4448\n[M+H]\n1\n260.60\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n358\n622.447463\n262.186356\n-4.278869\n0.605049\n\n\n18\nCer 42:02\nC42H81NO3\nNaN\n630.6189\n[M+H-H2O]\n1\n275.42\nLipids and lipid-like molecules\nSphingolipids\nCeramides\n371\n630.621440\n278.570366\n-4.028141\n1.130905\n\n\n19\nCer 42:01\nC42H83NO3\nNaN\n632.6346\n[M+H-H2O]\n1\n277.23\nLipids and lipid-like molecules\nSphingolipids\nCeramides\n376\n632.637809\n281.892273\n-5.072188\n1.653920\n\n\n20\n1,2-Dilauroyl-sn-glycero-3-phosphocholine\nC32H64NO8P\n18194-25-7\n644.4268\n[M+Na]\n1\n263.70\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n388\n644.430335\n259.430516\n-5.484800\n1.645714\n\n\n21\nPE (O-32:01)\nC37H74NO7P\nNaN\n720.4920\n[M+2Na-H]\n1\n269.40\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoethanolamines\n509\n720.478763\n274.019176\n18.372030\n1.685713\n\n\n22\nPC (16:1/16:1) (del9-cis)\nC40H76NO8P\n4724-96-3\n730.5387\n[M+H]\n1\n278.40\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n528\n730.537578\n282.629394\n1.536049\n1.496445\n\n\n23\n1,2-Dipalmitoyl-sn-glycero-3-phosphocholine\nC40H80NO8P\n63-89-8\n734.5700\n[M+H]\n1\n284.60\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n540\n734.568422\n289.282809\n2.147626\n1.618765\n\n\n24\nSM 36:01\nC41H83N2O6P\nNaN\n735.5781\n[M+Na-H2O]\n1\n290.30\nLipids and lipid-like molecules\nSphingolipids\nPhosphosphingolipids\n541\n735.572123\n289.413082\n8.125111\n0.306454\n\n\n25\n1-Palmitoyl-2-oleoyl-sn-glycero-3-phosphoethan...\nC39H76NO8P\n26662-94-2\n740.5207\n[M+Na]\n1\n281.70\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoethanolamines\n545\n740.522002\n280.097591\n-1.757631\n0.572090\n\n\n26\nPE 34:01\nC39H76NO8P\nNaN\n740.5207\n[M+Na]\n1\n277.10\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoethanolamines\n545\n740.522002\n280.097591\n-1.757631\n1.070195\n\n\n27\n1,2-Diheptadecanoyl-sn-glycero-3-phosphoethano...\nC39H78NO8P\n140219-78-9\n742.5363\n[M+Na]\n1\n282.10\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoethanolamines\n548\n742.537248\n279.640666\n-1.276611\n0.879462\n\n\n28\nPE 34:01\nC39H76NO8P\nNaN\n756.4946\n[M+K]\n1\n278.70\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoethanolamines\n572\n756.480464\n278.396763\n18.686354\n0.108923\n\n\n29\n1,2-Dipalmitoyl-sn-glycero-3-phosphocholine\nC40H80NO8P\n63-89-8\n756.5520\n[M+Na]\n1\n286.20\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n573\n756.552206\n287.253995\n-0.272643\n0.366921\n\n\n30\nPC (18:1(9Z)/16:0)\nC42H82NO8P\n59491-62-2\n760.5856\n[M+H]\n1\n287.90\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n579\n760.582752\n291.934324\n3.744116\n1.381929\n\n\n31\nDi(2-ethylhexyl) adipate\nC22H42O4\n103-23-1\n763.6064\n[2M+Na]\n1\n294.70\nLipids and lipid-like molecules\nFatty acyls\nFatty acid esters\n585\n763.598494\n294.424703\n10.353029\n0.093503\n\n\n32\nPE 36:03\nC41H76NO8P\nNaN\n764.5207\n[M+Na]\n1\n278.70\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoethanolamines\n586\n764.521398\n282.702581\n-0.912694\n1.415827\n\n\n33\nPE (18:1/18:1)(del9-cis)\nC41H78NO8P\nNaN\n766.5363\n[M+Na]\n1\n285.80\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoethanolamines\n591\n766.535777\n283.103817\n0.682387\n0.952365\n\n\n34\nPE 36:02\nC41H78NO8P\nNaN\n766.5363\n[M+Na]\n1\n281.00\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoethanolamines\n591\n766.535777\n283.103817\n0.682387\n0.743126\n\n\n35\nPE (18:1/18:1)(del9-cis)\nC41H78NO8P\nNaN\n766.5363\n[M+Na]\n1\n285.80\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoethanolamines\n592\n766.535407\n287.758043\n1.164832\n0.680448\n\n\n36\nGlcCer 36:01 OH\nC42H81NO9\nNaN\n766.5809\n[M+Na]\n1\n288.70\nLipids and lipid-like molecules\nSphingolipids\nGlycosphingolipids\n593\n766.573442\n291.006475\n9.728708\n0.792586\n\n\n37\nPE 36:01\nC41H80NO8P\nNaN\n768.5520\n[M+Na]\n1\n283.30\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoethanolamines\n596\n768.552311\n287.198305\n-0.404387\n1.357356\n\n\n38\nSM 36:01\nC41H83N2O6P\nNaN\n769.5626\n[M+K]\n1\n288.30\nLipids and lipid-like molecules\nSphingolipids\nPhosphosphingolipids\n598\n769.555997\n286.955141\n8.580261\n0.468665\n\n\n39\n1,2-Distearoyl-sn-glycero-3-phosphoethanolamine\nC41H82NO8P\n1069-79-0\n770.5676\n[M+Na]\n1\n289.80\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoethanolamines\n600\n770.567181\n289.246640\n0.543238\n0.191311\n\n\n40\nPC 34:03\nC42H78NO8P\nNaN\n778.5363\n[M+Na]\n1\n283.10\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n616\n778.536287\n287.489106\n0.016594\n1.526703\n\n\n41\nPC (18:1(9Z)/16:0)\nC42H82NO8P\n59491-62-2\n782.5676\n[M+Na]\n1\n292.10\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n622\n782.567462\n291.542761\n0.176267\n0.191135\n\n\n42\nPC (18:1/18:1) (del9-trans)\nC44H84NO8P\n56782-46-8\n786.6013\n[M+H]\n1\n293.30\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n629\n786.598330\n295.581854\n3.775213\n0.771987\n\n\n43\nPE 36:01\nC41H80NO8P\nNaN\n790.5339\n[M+2Na-H]\n1\n284.90\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoethanolamines\n638\n790.537247\n285.507623\n-4.233978\n0.212822\n\n\n44\n1,2-Distearoyl-sn-glycero-3-phosphocholine\nC44H88NO8P\n816-94-4\n790.6326\n[M+H]\n1\n297.60\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n640\n790.622388\n299.132978\n12.916392\n0.512474\n\n\n45\nGlcCer 38:01 OH\nC44H85NO9\nNaN\n794.6122\n[M+Na]\n1\n294.20\nLipids and lipid-like molecules\nSphingolipids\nGlycosphingolipids\n650\n794.603740\n297.520120\n10.646353\n1.115931\n\n\n46\nPC 34:02\nC42H80NO8P\nNaN\n796.5259\n[M+K]\n1\n284.40\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n654\n796.510867\n285.289684\n18.873542\n0.311853\n\n\n47\nPE (O-38:05)\nC43H78NO7P\nNaN\n796.5233\n[M+2Na-H]\n1\n283.60\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoethanolamines\n654\n796.510867\n285.289684\n15.609305\n0.592270\n\n\n48\nPC (18:1/18:1) (del9-trans)\nC44H84NO8P\n56782-46-8\n808.5833\n[M+Na]\n1\n296.90\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n680\n808.578809\n295.966653\n5.553767\n0.315355\n\n\n49\n1,2-Distearoyl-sn-glycero-3-phosphocholine\nC44H88NO8P\n816-94-4\n812.6146\n[M+Na]\n1\n298.60\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n688\n812.611023\n299.193222\n4.401900\n0.198274\n\n\n50\nd7-TG (15:0-18:1)\nC51H89D7O6\n2097561-17-4\n812.7724\n[M+H]\n1\n302.00\nLipids and lipid-like molecules\nGlycerolipids\nMonoradylglycerols\n689\n812.670574\n305.824841\n125.297981\n1.250664\n\n\n51\nSM 42:02\nC47H93N2O6P\nNaN\n817.6563\n[M+Na-H2O]\n1\n305.60\nLipids and lipid-like molecules\nSphingolipids\nPhosphosphingolipids\n699\n817.649049\n304.204308\n8.868113\n0.458801\n\n\n52\nSM 42:00\nC47H97N2O6P\nNaN\n817.7162\n[M+H]\n1\n306.50\nLipids and lipid-like molecules\nSphingolipids\nPhosphosphingolipids\n700\n817.705902\n311.478752\n12.593910\n1.598424\n\n\n53\nPS 36:04\nC42H74NO10P\nNaN\n828.4767\n[M+2Na-H]\n1\n283.80\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoserines\n717\n828.463720\n281.481017\n15.667531\n0.823851\n\n\n54\nPE 39:02\nC44H84NO8P\nNaN\n830.5652\n[M+2Na-H]\n1\n293.00\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoethanolamines\n724\n830.563142\n296.932805\n2.477361\n1.324477\n\n\n55\nPS 37:04\nC43H76NO10P\nNaN\n842.4924\n[M+2Na-H]\n1\n288.10\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphoserines\n744\n842.479425\n285.163722\n15.400504\n1.029681\n\n\n56\n1,2-Diarachidoyl-sn-glycero-3-phosphocholine\nC48H96NO8P\n61596-53-0\n846.6952\n[M+H]\n1\n308.00\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n753\n846.685887\n311.941168\n10.999307\n1.263433\n\n\n57\n1,2-Diarachidoyl-sn-glycero-3-phosphocholine\nC48H96NO8P\n61596-53-0\n868.6772\n[M+Na]\n1\n310.70\nLipids and lipid-like molecules\nGlycerophospholipids\nGlycerophosphocholines\n777\n868.676053\n310.987409\n1.320390\n0.092418\n\n\n58\nDiisononyl hexahydrophthalate\nC26H48O4\n166412-78-8\n871.7003\n[2M+Na]\n1\n316.70\nLipids and lipid-like molecules\nFatty acyls\nFatty alcohol esters\n784\n871.695489\n313.453756\n5.518589\n1.035637\n\n\n\n\n\n\n\nWe got some matches and we can view their ion images:\n\nimage, _  = timsimaging.plotting.image(dataset, i=539, results=results)\nshow(image)\n\n\n  \n\n\n\n\n\n\n\n2.0.5 Compare with annotation results from METASPACE\nHere we compare using LIPID MAPS\n\nmetaspace_results = pd.read_csv(r\"D:\\dataset\\Melanie\\metaspace_annotations.csv\", header=2)\nmetaspace_results\n\n\n\n\n\n\n\n\ngroup\ndatasetName\ndatasetId\nformula\nadduct\nchemMod\nion\nmz\nmsm\nfdr\n...\nmoleculeIds\nminIntensity\nmaxIntensity\ntotalIntensity\nisomeric_mols_count\nisomeric_ions_count\nisobaric_ions_count\noffSample\nrawOffSampleProb\nisobarIons\n\n\n\n\n0\nNaN\nMF402upper_noim\n2026-01-07_13h02m29s\nC40H80NO8P\nM+H\nNaN\nC40H80NO8P+H+\n734.569432\n0.932096\n0.05\n...\nLMGP01010418, LMGP01010463, LMGP01010488, LMGP...\n0\n43689\n492517728\n25\n0\n0\nNaN\nNaN\nNaN\n\n\n1\nNaN\nMF402upper_noim\n2026-01-07_13h02m29s\nC38H77N2O7P\nM+H\nNaN\nC38H77N2O7P+H+\n705.554116\n0.903219\n0.05\n...\nLMSP03020062, LMSP03020082\n0\n11954\n51471516\n2\n0\n0\nNaN\nNaN\nNaN\n\n\n2\nNaN\nMF402upper_noim\n2026-01-07_13h02m29s\nC41H83N2O6P\nM+H\nNaN\nC41H83N2O6P+H+\n731.606152\n0.852665\n0.05\n...\nLMSP03010052, LMSP03020018, LMSP03010001, LMSP...\n0\n11995\n113299328\n6\n0\n0\nNaN\nNaN\nNaN\n\n\n3\nNaN\nMF402upper_noim\n2026-01-07_13h02m29s\nC45H91N2O6P\nM+H\nNaN\nC45H91N2O6P+H+\n787.668752\n0.848176\n0.05\n...\nLMSP03010073, LMSP03010006\n0\n10226\n91480856\n2\n0\n0\nNaN\nNaN\nNaN\n\n\n4\nNaN\nMF402upper_noim\n2026-01-07_13h02m29s\nC33H64NO9P\nM+H\nNaN\nC33H64NO9P+H+\n650.439146\n0.826815\n0.05\n...\nLMGP20010008\n0\n12940\n90582144\n1\n0\n0\nNaN\nNaN\nNaN\n\n\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n...\n\n\n91\nNaN\nMF402upper_noim\n2026-01-07_13h02m29s\nC35H64NO10P\nM+H\nNaN\nC35H64NO10P+H+\n690.434061\n0.307145\n0.10\n...\nLMGP03010164, LMGP03010278, LMGP03010052, LMGP...\n0\n1975\n15041466\n4\n0\n0\nNaN\nNaN\nNaN\n\n\n92\nNaN\nMF402upper_noim\n2026-01-07_13h02m29s\nC36H68NO10P\nM+H\nNaN\nC36H68NO10P+H+\n706.465361\n0.300800\n0.10\n...\nLMGP03010165, LMGP03010203, LMGP03010249, LMGP...\n0\n1686\n11925794\n10\n0\n1\nNaN\nNaN\nC38H69NO8+K+\n\n\n93\nNaN\nMF402upper_noim\n2026-01-07_13h02m29s\nC40H81N2O6P\nM+H\nNaN\nC40H81N2O6P+H+\n717.590502\n0.239693\n0.10\n...\nLMSP03010044, LMSP03010045, LMSP03020024, LMSP...\n0\n1097\n10183518\n4\n0\n0\nNaN\nNaN\nNaN\n\n\n94\nNaN\nMF402upper_noim\n2026-01-07_13h02m29s\nC39H74NO8P\nM+H\nNaN\nC39H74NO8P+H+\n716.522482\n0.228522\n0.10\n...\nLMGP01011387, LMGP01011478, LMGP02010416, LMGP...\n0\n1327\n8856583\n24\n0\n0\nNaN\nNaN\nNaN\n\n\n95\nNaN\nMF402upper_noim\n2026-01-07_13h02m29s\nC46H80NO10P\nM+H\nNaN\nC46H80NO10P+H+\n838.559261\n0.205566\n0.10\n...\nLMGP03010339, LMGP03010422, LMGP03010580, LMGP...\n0\n1455\n7769442\n14\n0\n1\nNaN\nNaN\nC44H82NO10P+Na+\n\n\n\n\n96 rows × 24 columns\n\n\n\n\nmetaspace_ions = metaspace_results[[\"formula\", \"adduct\"]].copy()\nmetaspace_ions[\"adduct\"] = metaspace_ions[\"adduct\"].map(lambda x: f\"[{x}]\".format(x))\ntimsimaging_ions = final_results[[\"Neutral.Formula\", \"Ion.Species\"]].copy()\ntimsimaging_ions.columns = [\"formula\", \"adduct\"]\nintersection = timsimaging_ions.merge(\n    metaspace_ions,\n    on=[\"formula\", \"adduct\"],\n    how=\"inner\"\n)\nintersection\n\n\n\n\n\n\n\n\nformula\nadduct\n\n\n\n\n0\nC40H76NO8P\n[M+H]\n\n\n1\nC40H80NO8P\n[M+H]\n\n\n2\nC39H78NO8P\n[M+Na]\n\n\n3\nC40H80NO8P\n[M+Na]\n\n\n4\nC41H76NO8P\n[M+Na]\n\n\n5\nC41H80NO8P\n[M+Na]\n\n\n6\nC41H82NO8P\n[M+Na]\n\n\n7\nC42H78NO8P\n[M+Na]\n\n\n8\nC42H82NO8P\n[M+Na]\n\n\n9\nC48H96NO8P\n[M+Na]\n\n\n\n\n\n\n\n{#ion image from metaspace width=“60%”}",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Downstream Analysis -- feature annotation</span>"
    ]
  }
]